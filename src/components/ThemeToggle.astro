---
// 主题切换按钮组件
---

<button
  id="theme-toggle"
  class="theme-toggle not-underline-hover inline-flex items-center cursor-pointer"
  aria-label="切换深色/浅色模式"
  title="切换主题"
>
  <span class="sun-icon i-mdi-weather-sunny w-6 h-6"></span>
  <span class="moon-icon i-mdi-weather-night w-6 h-6 hidden"></span>
</button>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById('theme-toggle')
    const html = document.documentElement
    const sunIcon = toggle?.querySelector('.sun-icon')
    const moonIcon = toggle?.querySelector('.moon-icon')

    // 从 localStorage 读取保存的主题，如果没有则使用系统偏好
    function getTheme() {
      const stored = localStorage.getItem('theme')
      if (stored) return stored
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
    }

    // 应用主题
    function applyTheme(theme: string) {
      const isDark = theme === 'dark'
      html.classList.toggle('dark', isDark)

      // 更新图标显示
      if (sunIcon && moonIcon) {
        if (isDark) {
          sunIcon.classList.add('hidden')
          moonIcon.classList.remove('hidden')
        } else {
          sunIcon.classList.remove('hidden')
          moonIcon.classList.add('hidden')
        }
      }

      // 保存到 localStorage
      localStorage.setItem('theme', theme)
    }

    // 初始化主题
    const currentTheme = getTheme()
    applyTheme(currentTheme)

    // 切换主题
    toggle?.addEventListener('click', () => {
      const currentTheme = getTheme()
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark'
      applyTheme(newTheme)
    })

    // 监听系统主题变化（仅当用户未手动设置时）
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        applyTheme(e.matches ? 'dark' : 'light')
      }
    })
  }

  // 页面加载时初始化
  initThemeToggle()

  // 支持 Swup 页面转换
  document.addEventListener('swup:contentReplaced', initThemeToggle)
</script>

<style>
  .theme-toggle {
    border: none;
    background: transparent;
    padding: 0;
    transition: transform 0.2s ease;
  }

  .theme-toggle:hover {
    transform: scale(1.1);
  }

  .theme-toggle:active {
    transform: scale(0.95);
  }
</style>
